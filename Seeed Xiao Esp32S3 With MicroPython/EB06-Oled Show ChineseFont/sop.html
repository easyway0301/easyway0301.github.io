<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <title>從零開始學Esp32</title>

    <style>
        body {
            font-family: Arial, "Microsoft JhengHei", sans-serif;
            line-height: 1.9;
            max-width: 980px;
            margin: 40px auto;
            padding: 0 20px;
            color: #222;
            background-color: #f5f7fa;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #555;
            margin-bottom: 50px;
        }

        section {
            background: #ffffff;
            border-radius: 14px;
            padding: 40px;
            margin-bottom: 50px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
        }

        h2 {
            margin-top: 0;
            border-left: 6px solid #4caf50;
            padding-left: 14px;
        }

        p {
            margin: 14px 0;
        }

        ul {
            margin-left: 22px;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 28px auto 10px;
            border-radius: 12px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .text-red {
            color: #ff0000;
        }

        .text-blue {
            color: #1f6feb;
        }

        .text-green {
            color: #4caf50;
        }

        .highlight-yellow {
            background-color: #ffff00;
            /* 螢光黃背景 */
            color: #000000;
            /* 黑色文字，比較清楚 */
            padding: 2px 4px;
            /* 可選：讓背景有點空間 */
            border-radius: 2px;
            /* 可選：圓角 */
            font-weight: bold;
            /* 可選：文字加粗更醒目 */
        }

        .redbackground {
            background: #ff8e90;
            border-left: 6px solid #ff1a00;
            padding: 16px 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 16px;
        }

        .greenbackground {
            background: #e8f5e9;
            border-left: 6px solid #4caf50;
            padding: 16px 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 16px;
        }

        .orangebackground {
            background: #fff3e0;
            border-left: 6px solid #ff9800;
            padding: 16px 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 16px;
        }

        a {
            color: #2e7d32;
            text-decoration: none;
            font-weight: bold;
        }

        a:hover {
            text-decoration: underline;
        }

        /* Code block */
        .code-block {
            position: relative;
            background: #0d1117;
            color: #c9d1d9;
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            font-family: Consolas, Monaco, monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .code-block pre {
            margin: 0;
            white-space: pre;
        }

        .copy-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: #1f6feb;
            /* GitHub 藍 */
            color: white;
            border: none;
            border-radius: 6px;
            padding: 6px 14px;
            cursor: pointer;
            font-size: 13px;
        }

        .copy-btn:hover {
            background: #388bfd;
        }

        .link-icons {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .link-icons a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            border-radius: 12px;
            background: #f1f3f6;
            color: #222;
            text-decoration: none;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition:
                transform 0.15s ease,
                box-shadow 0.15s ease;
        }

        .link-icons a:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
        }

        /* ⭐ 關鍵：圖示等寬 */
        .link-icons .icon {
            width: 28px;
            /* 固定寬度 */
            text-align: center;
            /* 置中 emoji */
            font-size: 20px;
            line-height: 1;
        }

        .link-icons .text {
            font-weight: 500;
        }
    </style>
</head>

<body>

    <h1>EB05 - OLED 顯示中文字</h1>

    <section>
        <h2>程式說明</h2>
        <p>在擴充板上的 OLED 顯示中文字，並使用波特律動網站建的 FONT16 字型。</p>
        <ul>
            <li>
                <p>先到<a href="https://led.baud-dance.com/">波特律動網站</a>建立需要的中文字。</p>
            </li>
            <li>波特律動的字體用文泉驿·点阵字16，寬跟高都是16。</li>
            <li>取模方式選逐行式。</li>
            <li>阴阳码選擇阳码。</li>
            <li>生成模板選擇波特律动OLED驱动。</li>

        </ul>
    </section>

    <section>
        <h2>範例程式碼(font16.py)</h2>

        <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>
# font16.py
# https://led.baud-dance.com/
# 字體用文泉驿·点阵字16，選逐行式
# 波特律動網站提供的數據

FONT16 = {
    "你": [0xe4,0xbd,0xa0,0x00,0x10,0x01,0x10,0x01,0x10,0x01,0x88,0x7f,0x88,0x40,0x4c,0x20,0x2c,0x04,0x0a,0x04,0x89,0x14,0x88,0x24,0x48,0x24,0x48,0x44,0x28,0x44,0x08,0x04,0x08,0x05,0x08,0x02],

    "好": [0xe5,0xa5,0xbd,0x00,0x08,0x00,0x08,0x3f,0x08,0x20,0x08,0x10,0x3f,0x08,0x24,0x04,0x24,0x04,0xa4,0x7f,0x24,0x04,0x12,0x04,0x14,0x04,0x08,0x04,0x14,0x04,0x22,0x04,0x21,0x05,0x00,0x02],

    "嗎": [0xe5,0x97,0x8e,0x00,0x00,0x00,0x80,0x7f,0x9e,0x04,0x92,0x3f,0x92,0x04,0x92,0x3f,0x92,0x04,0x92,0x04,0x92,0x7f,0x12,0x40,0x5e,0x55,0x52,0x55,0x40,0x55,0x40,0x40,0x00,0x28,0x00,0x01],
}

        </code></pre>
        </div>
    </section>

    <section>
        <h2>範例程式碼(ChineseFont.py)</h2>

        <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>
# 從 machine 模組匯入 Pin（腳位控制）與 I2C
from machine import Pin, I2C

# 匯入 SSD1306 OLED 顯示器的驅動程式
import ssd1306

# 匯入波特律動網站做的文字
from font16 import FONT16

# 建立 I2C 物件
i2c = I2C(0, sda=Pin(5), scl=Pin(6), freq=400000)

# 掃描 I2C 匯流排
print(i2c.scan())

# 建立 SSD1306 OLED 物件
oled = ssd1306.SSD1306_I2C(128, 64, i2c, addr=0x3C)

# 清空畫面
oled.fill(0)

# 顯示文字
oled.text16("你好嗎", 0, 0)

# 將內容顯示到 OLED
oled.show()
        </code></pre>
        </div>
    </section>

    <section>
        <h2>範例程式碼(ssd1306.py)</h2>
        <span class="highlight-yellow">注意，這個ssd1306.py有新增方法，跟之前範例的不同。</span>
        <div class="code-block">
            <button class="copy-btn" onclick="copyCode(this)">Copy</button>
            <pre><code>
# MicroPython SSD1306 OLED driver, I2C and SPI interfaces

from micropython import const
import framebuf

# 將波特律動 16x16 字模匯入
from font16 import FONT16


SET_CONTRAST = const(0x81)
SET_ENTIRE_ON = const(0xA4)
SET_NORM_INV = const(0xA6)
SET_DISP = const(0xAE)
SET_MEM_ADDR = const(0x20)
SET_COL_ADDR = const(0x21)
SET_PAGE_ADDR = const(0x22)
SET_DISP_START_LINE = const(0x40)
SET_SEG_REMAP = const(0xA0)
SET_MUX_RATIO = const(0xA8)
SET_COM_OUT_DIR = const(0xC0)
SET_DISP_OFFSET = const(0xD3)
SET_COM_PIN_CFG = const(0xDA)
SET_DISP_CLK_DIV = const(0xD5)
SET_PRECHARGE = const(0xD9)
SET_VCOM_DESEL = const(0xDB)
SET_CHARGE_PUMP = const(0x8D)

class SSD1306:
    def __init__(self, width, height, external_vcc):
        self.width = width
        self.height = height
        self.external_vcc = external_vcc
        self.pages = self.height // 8
        self.buffer = bytearray(self.pages * self.width)
        self.fb = framebuf.FrameBuffer(
            self.buffer, self.width, self.height, framebuf.MONO_VLSB
        )
        self.init_display()

    def init_display(self):
        for cmd in (
            SET_DISP | 0x00,
            SET_MEM_ADDR, 0x00,
            SET_DISP_START_LINE | 0x00,
            SET_SEG_REMAP | 0x01,
            SET_MUX_RATIO, self.height - 1,
            SET_COM_OUT_DIR | 0x08,
            SET_DISP_OFFSET, 0x00,
            SET_COM_PIN_CFG, 0x02 if self.height == 32 else 0x12,
            SET_DISP_CLK_DIV, 0x80,
            SET_PRECHARGE, 0x22 if self.external_vcc else 0xF1,
            SET_VCOM_DESEL, 0x30,
            SET_CONTRAST, 0xFF,
            SET_ENTIRE_ON,
            SET_NORM_INV,
            SET_CHARGE_PUMP, 0x10 if self.external_vcc else 0x14,
            SET_DISP | 0x01,
        ):
            self.write_cmd(cmd)

    def fill(self, col):
        self.fb.fill(col)

    def pixel(self, x, y, col):
        self.fb.pixel(x, y, col)

    def text(self, string, x, y, col=1):
        self.fb.text(string, x, y, col)

    def show(self):
        self.write_cmd(SET_COL_ADDR)
        self.write_cmd(0)
        self.write_cmd(self.width - 1)
        self.write_cmd(SET_PAGE_ADDR)
        self.write_cmd(0)
        self.write_cmd(self.pages - 1)
        self.write_data(self.buffer)

class SSD1306_I2C(SSD1306):
    def __init__(self, width, height, i2c, addr=0x3C, external_vcc=False):
        self.i2c = i2c
        self.addr = addr
        self.temp = bytearray(2)
        super().__init__(width, height, external_vcc)

    def write_cmd(self, cmd):
        self.temp[0] = 0x80
        self.temp[1] = cmd
        self.i2c.writeto(self.addr, self.temp)

    def write_data(self, buf):
        self.i2c.writeto(self.addr, b"\x40" + buf)
        
    def _font16_row_to_vlsb(self, font):
        """
        將波特律動 16x16 字模轉 SSD1306 MONO_VLSB 可用格式
        保持字型方向正確（水平排列），不鏡像、不旋轉
        """
        out = bytearray(32)  # 16x16 -> 32 bytes
        img = font[4:]       # 跳過前 4 bytes 頭部

        for i in range(16):  # 波特律動原本 Column
            byte_top = img[i*2]
            byte_bottom = img[i*2+1]

            # 上半部 8 pixel
            for bit in range(8):
                if byte_top & (1 << bit):
                    page = i // 8
                    out[page*16 + bit] |= 1 << (i % 8)

            # 下半部 8 pixel
            for bit in range(8):
                if byte_bottom & (1 << bit):
                    page = i // 8
                    out[page*16 + bit + 8] |= 1 << (i % 8)

        return out

    def text16(self, text, x, y, spacing=0):
        """
        直接在 OLED 上顯示多個 FONT16 中文字
        用法：oled.text16("你好嗎", 0, 32)
        """
        cx = x
        for ch in text:
            raw = FONT16.get(ch)
            if raw:
                data = self._font16_row_to_vlsb(raw)
                fb = framebuf.FrameBuffer(bytearray(data), 16, 16, framebuf.MONO_VLSB)
                self.fb.blit(fb, cx, y)
            cx += 16 + spacing
        </code></pre>
        </div>
    </section>

    <script>
        function copyCode(btn) {
            const code = btn.nextElementSibling.innerText;
            navigator.clipboard.writeText(code);
            btn.innerText = "Copied!";
            setTimeout(() => btn.innerText = "Copy", 1500);
        }
    </script>

</body>

</html>
